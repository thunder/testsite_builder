# Testsite Builder

The Testsite Builder provides Drupal console commands for creation of test sites based on the report generated by [Sampler module](https://github.com/thunder/sampler).

## Prerequisites
Your project should be setup to use composer for installing required modules. Projects, that are differently setup are
not supported.

This module provides Drupal console commands only. If you do not already use Drupal console, install it before continuing.

See https://drupalconsole.com/docs for more information on how to install it.

## Installation

In your project root do:

    composer require thunder/testsite_builder

Then enable the testsite_builder module, either with command line or in the admin ui.

    drush en testsite_builder

Flush the caches and you are ready to go.

### Adjust database
In order to use the content creation, the MySQL database needs to be adjusted.

#### Grant files
Login as root and execute

    GRANT FILE on *.* to 'drupaluser'@'localhost'

#### Adjust config
Open your my.cnf and add
```
[mysqld]
   secure-file-priv=""
```

## Usage

#### Create configuration

To create site configuration from Sampler report, you can execute the following command:
`drupal testsite-builder:create-config <sampler report JSON file>`

That command will remove all existing content and configuration for the site and generate new configuration from provided Sampler report file.

#### Create configuration and content

To create site configuration from Sampler report and content for it, you can execute the following command:
`drupal testsite-builder:create-config <sampler report JSON file> --create-content`

That command will remove all existing content and configuration for the site, generate new configuration and content from the provided Sampler report file.

The Testsite Builder will execute the content creation task in the following steps:
1. it will create content and store them in temporal CSV files ready for database import
2. it will import created CSV files into database
3. it will delete temporal CSV files after database import

If you want to investigate CSV files and intermediary configuration used for content creation, you can add an option to the previous command to keep created files. Like this:
`drupal testsite-builder:create-config <sampler report JSON file> --create-content --keep-content-files`

In this case, the Testsite Builder will skip step 3 and the command will output path to temp directory with generated CSV files.
